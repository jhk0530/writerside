name: Build documentation

on:
    push:
        branches: ["main"]
    workflow_dispatch:

permissions:
    id-token: write
    pages: write

env:
    INSTANCE: Writerside/ft    
    DOCKER_VERSION: 2.1.1479-p3869

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout repository
          uses: actions/checkout@v3

        - name: Build Writerside docs using Docker
          uses: JetBrains/writerside-github-action@v4
          with:
            instance: ${{ env.INSTANCE }}
            docker-version: ${{ env.DOCKER_VERSION }}

    deploy:
        environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}
        needs: test
        runs-on: ubuntu-latest
        steps:            
            - name: Setup Pages
              uses: actions/configure-pages@v2
            
            - name: Deploy to GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v1
